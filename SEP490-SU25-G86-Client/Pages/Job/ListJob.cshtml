@page
@model SEP490_SU25_G86_Client.Pages.Job.ListJobModel
@{
    ViewData["Title"] = "List Job";
}

<div class="container py-5">
    <header class="text-center mb-5">
        <h1 class="fw-bold border-bottom pb-3">Danh sách tin tuyển dụng</h1>
    </header>

    <div class="search-filter mb-4">
        <div class="row g-3">
            <div class="col-12 col-md-6">
                <div class="input-group">
                    <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                    <input type="text" id="searchInput" class="form-control" placeholder="Tìm kiếm theo địa điểm hoặc trạng thái">
                </div>
            </div>
            <div class="col-6 col-md-3">
                <select class="form-select" id="locationFilter">
                    <option value="">Chọn địa điểm</option>
                    <option value="Hà Nội">Hà Nội</option>
                    <option value="Hồ Chí Minh">Hồ Chí Minh</option>
                    <option value="Đà Nẵng">Đà Nẵng</option>
                </select>
            </div>
            <div class="col-6 col-md-3">
                <select class="form-select" id="statusFilter">
                    <option value="">Trạng thái</option>
                    <option value="OPEN">OPEN</option>
                    <option value="CLOSED">CLOSED</option>
                </select>
            </div>
        </div>
    </div>

    <div class="row g-4" id="jobListContainer">
        <!-- Jobs sẽ được render vào đây -->
    </div>
</div>

@section Scripts {
    <script>
        const apiUrl = 'https://localhost:7004/api/JobPosts'; // đổi nếu khác

        async function loadJobs() {
            try {
                const res = await fetch(apiUrl);
                const jobs = await res.json();
                renderJobs(jobs);
            } catch (error) {
                console.error('Lỗi khi gọi API:', error);
            }
        }

        function renderJobs(jobs) {
            const container = document.getElementById('jobListContainer');
            container.innerHTML = '';

            jobs.forEach(job => {
                const badgeClass = job.status === 'OPEN' ? 'bg-success' : 'bg-danger';

                const html = `
                        <div class="col-12 col-md-6">
                            <div class="card job-card h-100">
                                <div class="card-body position-relative">
                                    <span class="badge ${badgeClass} position-absolute top-0 end-0 mt-3 me-3">${job.status}</span>
                                    <h5 class="card-title fw-bold mb-3">${job.title}</h5>
                                    <p class="card-text location mb-2">
                                        <i class="bi bi-geo-alt me-2"></i>${job.workLocation}
                                    </p>
                                    <div class="dates mb-3">
                                        <small class="text-muted">Created: ${formatDate(job.createdDate)}</small><br>
                                        <small class="text-muted">End Date: ${formatDate(job.endDate)}</small>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <a href="/job/details/${job.jobPostId}" class="btn btn-outline-primary">View Details</a>
                                        <a href="/job/edit/${job.jobPostId}" class="btn btn-outline-secondary">Edit</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        `;

                container.insertAdjacentHTML('beforeend', html);
            });
        }

        function formatDate(dateStr) {
            const d = new Date(dateStr);
            return d.toLocaleDateString('vi-VN');
        }

        document.addEventListener('DOMContentLoaded', loadJobs);
    </script>
}

